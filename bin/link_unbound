#!/bin/bash

# Check if the user is a root user with EUID
if [ "$EUID" -ne 0 ]; then
    echo "This script requires superuser privileges. Please run it as root."
    exit 1
fi

# Prompt the user for the username
echo "Enter the username to use for the copied files: "
read -r username

# Check if required directories exist
if [ ! -d "/etc/unbound" ] || [ ! -d "/root/bin" ] || [ ! -d "/home/$username" ] || [ ! -d "/home/$username/dotfiles" ]; then
    echo "Required directories do not exist."
    exit 1
fi

# Copy files and directories
cp -r /etc/systemd/system/unbound_blocklists.service "/home/$username/dotfiles/systemd/unbound_blocklists.service"
cp -r /etc/unbound "/home/$username/dotfiles/"
cp -r /root/bin/unbound-blocklist "/home/$username/dotfiles/bin"
cp -r /root/bin/link_unbound "/home/$username/dotfiles/bin"
#test -f "/home/$username/dotfiles/etc/" || mkdir "/home/$username/dotfiles/etc/" 
#test -f "/home/$username/dotfiles/etc/systemd/" || mkdir "/home/$username/dotfiles/etc/systemd/"
cp -r /etc/doas.conf "/home/$username/dotfiles/etc/"
cp -r /etc/systemd/resolved.conf "/home/$username/dotfiles/etc/systemd"
chmod +x "/home/$username/dotfiles/bin/link_unbound"

# Change ownership of the copied files
chown -R "$username:$username" "/home/$username"

exit 0
